<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Edit Project</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <style>
        body {
            margin-top: 50px;
            background-color: #8bde91; /* Light green background */
            font-family: Arial, sans-serif; /* Font style */
        }
        .img-thumbnail {
            max-width: 150px;
            margin: 5px;
            transition: transform 0.2s ease-in-out;
        }
        .img-thumbnail:hover {
            transform: scale(1.1);
        }
        .gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: start;
        }
        .gallery-item {
            position: relative;
            margin: 10px;
        }
        .gallery-item .removeImageBtn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 0, 0, 0.7);
            border: none;
            color: white;
            padding: 2px 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        .form-control-file {
            display: inline-block;
            margin-top: 5px;
        }
    </style>
</head>
<body class="container">

<% if (messages.error) { %>
    <div class="alert alert-danger" role="alert"><%- messages.error %></div>
<% } %>

<nav class="navbar navbar-light bg-light">
    <a class="navbar-brand" href="#">
        <img src="/images/1721125082933.jpeg" alt="Logo">
    </a>
    <form class="form-inline">
        <a href="/auth/logout" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> Logout</a>
        <a href="/books/layout/" class="btn btn-primary"><i class="fas fa-home"></i> Back Home</a>
    </form>
</nav>

<div class="card">
    <div class="card-header">
        Edit Project
    </div>
    <div class="card-body">
        <form action="/books/update/<%= id %>" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label>Name:</label>
                <input type="text" class="form-control" name="name" value="<%= name %>" autocomplete="off">
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea class="form-control" name="description" rows="3"><%= description %></textarea>
            </div>
            <div class="form-group">
                <label>Current Image:</label>
                <% if (image_url) { %>
                    <div class="gallery-item">
                        <img class="img-thumbnail" src="<%= image_url %>" alt="<%= name %>">
                        <button type="button" class="btn btn-sm btn-danger removeImageBtn" data-type="main">Remove</button>
                    </div>
                <% } else { %>
                    <p>No image uploaded</p>
                <% } %>
            </div>
            <div class="form-group">
                <label>New Image:</label>
                <input type="file" class="form-control-file" name="image" accept="image/*">
            </div>
            <div class="form-group">
                <label>Additional Images:</label>
                <div id="additionalImages" class="gallery">
                    <% images.forEach(function(image, index) { %>
                        <div class="gallery-item">
                            <img class="img-thumbnail" src="<%= image %>" alt="Additional Image <%= index + 1 %>">
                            <button type="button" class="btn btn-sm btn-danger removeImageBtn" data-type="additional">Remove</button>
                        </div>
                    <% }) %>
                </div>
                <input type="file" class="form-control-file" name="images" accept="image/*" multiple>
            </div>
            <input type="hidden" name="existing_image_url" value="<%= image_url %>">
            <input type="hidden" name="existing_images" value='<%= JSON.stringify(images) %>'>
            <div class="form-group">
                <input type="submit" class="btn btn-info" value="Update"/>
            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script>
    $(document).ready(function() {
        // Handle removal of main image
        $('#removeMainImageBtn').click(function() {
            if (confirm('Are you sure you want to remove this image?')) {
                $('.gallery-item img').remove();
                $('[name="existing_image_url"]').val('');
                $(this).remove();
            }
        });

        // Handle removal of additional images
        $(document).on('click', '.removeImageBtn[data-type="additional"]', function() {
            if (confirm('Are you sure you want to remove this image?')) {
                $(this).closest('.gallery-item').remove();
                updateExistingImagesField();
            }
        });

        // Update hidden input field for existing images
        function updateExistingImagesField() {
            let remainingImages = [];
            $('#additionalImages .img-thumbnail').each(function() {
                remainingImages.push($(this).attr('src'));
            });
            $('[name="existing_images"]').val(JSON.stringify(remainingImages));
        }
    });
</script>

</body>
</html>
